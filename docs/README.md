# SteamDB

[![License](https://img.shields.io/badge/License-MIT-green.svg)](https://opensource.org/licenses/MIT)
[![build](https://github.com/P90Master/steamdb/workflows/CI/badge.svg)](https://github.com/steamdb/steamdb/actions)

_Автономная распределенная система для сбора, агрегации и хранения истории цен в Steam_

## Оглавление

- [Описание](#описание)
- [Особенности системы](#особенности-системы)
- [Структура](#структура)
- [Карта сети](#карта-сети)
- [Deploy](#deploy)
- [TODO](#todo)

## Описание

> **Дисклеймер:** Данный проект - реконструкция базового функционала существующего [сервиса](https://steamdb.info), мотивированная исключительно моим желанием воссоздать подобную систему своими собственными руками. От оригинального проекта я взял только исходную задачу и решал ее со своим собственным видением этой системы, используя инструментарий, которым я владею, без оглядки на оригинальное решение.

Платформа [Steam](https://store.steampowered.com) предоставляет довольно скудный [API](https://developer.valvesoftware.com/wiki/Steam_Web_API): для взаимодействия со списком приложений имеются только 2 опции: запросить общий список приложений и запросить данные об приложении по id в контексте указанной страны. List-запрос не принимает каких-либо фильтров и выдает список пар `(app_id, name)`, сваливая в одну кучу ПО, игры, доп.контент. Detail-запрос по id и коду страны предоставляет полную информацию о приложении в контексте выбранной страны. Контекст влияет на валюту и цену, а также на доступность этого продукта в стране в целом. Цены являются актуальными, узнать сколько стоил продукт до этого через API невозможно.

_Сервис SteamDB автономно мигрирует данные о приложениях в Steam в собственную базу, ведёт историю цен и скидок в разных странах и предоставляет более функциональный API, включающий сортировку, пагинацию, фильтрацию и полнотекстовый поиск._

### Особенности системы:

- **Автономность:** сразу после деплоя система начинает непрерывный процесс миграции (а впоследствии синхронизации) данных, не требуя присутствия пользователя. Процессом руководит **сервис-оркестратор**, взаимодествуя с **worker-сервисами** посредством брокера сообщений [RabbitMQ](https://www.rabbitmq.com/).
- **Полнотекстовый Поиск:** Отдельный сервис с **ETL-пайплайном** периодически мигрирует данные из основной базы [MongoDB](https://www.mongodb.com/) в полнотекстовый индекс [Elasticsearch](https://www.elastic.co/), который используется для полнотекстового поиска.
- **Аутентификация/Авторизация:** Взаимодействие компонентов системы друг с другом регламентировано протоколом **OAuth 2.0** (а именно **Client Credentials Flow** [RFC 6749](https://www.rfc-editor.org/rfc/rfc6749#section-1.3.4)). За аутентификацию отвечает **Auth-сервис** - он выписывает access-токены со scopes сервисам-клиентам и проверяет токены по требованию сервисов-серверов. За авторизацию отвечают сами сервисы - разграничение доступа происходит на основе связанных с access-token'ом scopes, которые предоставляет Auth-сервис при успешной проверке токена.
- **Система Логгирования:** Логи с ключевых компонентов собираются, агрегируются и индексируются в [Elasticsearch](https://www.elastic.co/). Система основана на [стеке ELK](https://www.elastic.co/elastic-stack) с использованием [Filebeat](https://www.elastic.co/products/beats/filebeat) в качестве сборщиков и [Apache Kafka](https://kafka.apache.org/) в роли потокового брокера между сборщиками и [Logstash](https://www.elastic.co/products/logstash).

## Структура

Система состоит из **6** логических компонентов, каждый из них включает в себя нескольких микросервисов. Подробнее о каждом из компонентов можно почитать по гиперссылкам ниже:

- [Worker](WORKER.md)
- [Orchestrator](ORCHESTRATOR.md)
- [Backend]()
- [Full Text Search]()
- [Auth]()
- [Logs]()

## Карта сети

<p align="center">
  <img src="https://github.com/P90Master/steamdb/blob/main/docs/img/network_map.png" alt="Network Map">
</p>

## Deploy

...

## TODO

...